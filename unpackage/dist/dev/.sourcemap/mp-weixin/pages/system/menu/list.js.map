{"version":3,"sources":["uni-app:///main.js","webpack:///D:/桌面/onlineEducation1_admin/pages/system/menu/list.vue?36fc","webpack:///D:/桌面/onlineEducation1_admin/pages/system/menu/list.vue?f25a","webpack:///D:/桌面/onlineEducation1_admin/pages/system/menu/list.vue?6848","webpack:///D:/桌面/onlineEducation1_admin/pages/system/menu/list.vue?b483","uni-app:///pages/system/menu/list.vue","webpack:///D:/桌面/onlineEducation1_admin/pages/system/menu/list.vue?1b3a","webpack:///D:/桌面/onlineEducation1_admin/pages/system/menu/list.vue?09e8"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","rootModules","item","pluginMenuJsons","pluginModules","menus","depth","childrenIds","getChildren","data","query","where","orderby","options","pageSize","pageCurrent","selectedIndexs","loading","errMsg","currentTab","selectedPluginMenuIndexs","computed","pluginMenus","watch","methods","getSortMenu","menuList","onqueryload","patTree","tree","sortMenus","switchTab","loadData","clear","navigateTo","uni","url","events","refreshData","confirmDelete","ids","title","content","success","needConfirm","pluginMenuSelectChange","addPluginMenus","showCancel","mask","uniCloud","updateBuiltInMenu","res","db","_","menu_ids","addMenuList","menu_id","oldMenuListRes","oldMenuList","originalMenuList","create_date","addRes","icon","setTimeout","console"],"mappings":";;;;;;;;;;;;;AAAA;AAE2D;AAC3D;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,aAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAiH;AACjH;AACwD;AACL;AACa;;;AAGhE;AACsK;AACtK,gBAAgB,6KAAU;AAC1B,EAAE,0EAAM;AACR,EAAE,+EAAM;AACR,EAAE,wFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,mFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,gTAEN;AACP,KAAK;AACL;AACA,aAAa,iQAEN;AACP,KAAK;AACL;AACA,aAAa,+TAEN;AACP,KAAK;AACL;AACA,aAAa,gQAEN;AACP,KAAK;AACL;AACA,aAAa,8OAEN;AACP,KAAK;AACL;AACA,aAAa,8OAEN;AACP,KAAK;AACL;AACA,aAAa,8OAEN;AACP,KAAK;AACL;AACA,aAAa,oMAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC5IA;AAAA;AAAA;AAAA;AAAgnB,CAAgB,8mBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;ACkHpoB;AAIA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,IAAI,IAAsC;EAE1C,0CAIA;EACAC;IACA;IACAA;MACAC;MACAC;IACA;EACA;EAEA,4CAIA;EACAC;IACA;IACAA;MACAF;MACAC;IACA;EACA;AAiDA;;AAGA;AACA;EAAA;EACAE;IACA;MACAC;IACA;EACA;EACA;AACA;;AAEA;AACA;EAAA;EACA;IAAA;EAAA;IACAD;MACA;QACAE;QACAC;MACA;IACA;EACA;EACA;AACA;AAAA,eAEA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;MACA;MACAC;MAAA;MACAC;MACAZ;MACAa;MACAC;MACAC;IACA;EACA;EACAC;IACAC;MACA;MACA;QACA;MACA;MACA;MACA;QACA;MACA;MACAnB;QACA;QACA;UAAA;QAAA;UACAE;QACA;MACA;MACA;IACA;EACA;EACAkB;IACAD;MACA;QACA;MACA;IACA;EACA;EACAE;IACAC;MACA;MACAC;QACA;UAAA;QAAA;UACAxB;QACA;MACA;MACA;IACA;IACAyB;MACA;QACA;QACA;QACAzB;MACA;MACA;MACA;MACA;MACAO;MACAA;MACA;IACA;IACAmB;MAAA;MACAC;QACAC;QACA;UACA;QACA;MACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MAAA;MACA;QACAC;MACA;IACA;IACAC;MAAA;MAAA;MACAC;QACAC;QACAC;UACAC;YACA;UACA;QACA;MACA;IACA;IACAC;MAAA;MACA;MACA;MACA;MACA;MACA;MACAC;MACAL;QACAM;QACAC;QACAC;UACA;YACA;UACA;UACA;YACAC;UACA;QACA;MACA;IACA;IACAC;MACA;IACA;IACAC;MAAA;MACA;QACA;UACAL;UACAC;UACAK;QACA;MACA;MACA;MACA;MACA;QACA;QACA;UACA;UACA;UACA;UACA1C;QACA;MACA;MACA8B;QACAM;QACAC;QACAC;UACA;YACA;UACA;UACAR;YACAa;UACA;UACA;UACAC;YACA;YACAd;cACAM;cACAC;cACAK;cACAJ;gBACA;gBACA;kBACA;gBACA;gBACA;cACA;YACA;UACA;YACAR;cACAM;cACAC;cACAK;YACA;UACA;YACAZ;UACA;QACA;MACA;IACA;IACA;IACAe;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;gBACAf;kBACAM;kBACAC;kBACAC;oBAAA;sBAAA;sBAAA;wBAAA;0BAAA;4BAAA;8BAAA,KACAQ;gCAAA;gCAAA;8BAAA;8BACAC;8BACAC;8BACAC;gCACA;8BACA;8BACAnB;gCACAM;gCACAO;8BACA;8BAAA;8BAEAO,kBACA;8BAAA;8BAAA,OACAH;gCACAI;8BACA;4BAAA;8BAFAC;8BAGAC;8BACAC;gCACA;kCACA;gCACA;gCACA;kCACAJ,iDACArD;oCACA0D;kCAAA,GACA;gCACA;8BACA;8BAAA,MACAL;gCAAA;gCAAA;8BAAA;8BAAA;8BAAA,OAEAH;4BAAA;8BAAAS;8BACA1B;gCACAM;gCACAqB;8BACA;8BACAC;gCAKA;8BAEA;8BAAA;8BAAA;4BAAA;8BAEA5B;gCACAM;gCACAqB;8BACA;4BAAA;8BAAA;8BAAA;4BAAA;8BAAA;8BAAA;8BAGAE;4BAAA;8BAAA;8BAEA7B;8BAAA;4BAAA;4BAAA;8BAAA;0BAAA;wBAAA;sBAAA;oBAAA,CAGA;oBAAA;sBAAA;oBAAA;oBAAA;kBAAA;gBACA;cAAA;cAAA;gBAAA;YAAA;UAAA;QAAA;MAAA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;ACpdA;AAAA;AAAA;AAAA;AAAy4B,CAAgB,m2BAAG,EAAC,C;;;;;;;;;;;ACA75B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/system/menu/list.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;import '@dcloudio/vue-cli-plugin-uni/packages/uni-cloud/dist/index.js';\nimport Vue from 'vue'\nimport Page from './pages/system/menu/list.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./list.vue?vue&type=template&id=5890e632&\"\nvar renderjs\nimport script from \"./list.vue?vue&type=script&lang=js&\"\nexport * from \"./list.vue?vue&type=script&lang=js&\"\nimport style0 from \"./list.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/system/menu/list.vue\"\nexport default component.exports","export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./list.vue?vue&type=template&id=5890e632&\"","var components\ntry {\n  components = {\n    uniStatBreadcrumb: function () {\n      return import(\n        /* webpackChunkName: \"components/uni-stat-breadcrumb/uni-stat-breadcrumb\" */ \"@/components/uni-stat-breadcrumb/uni-stat-breadcrumb.vue\"\n      )\n    },\n    uniBadge: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-badge/components/uni-badge/uni-badge\" */ \"@/uni_modules/uni-badge/components/uni-badge/uni-badge.vue\"\n      )\n    },\n    unicloudDb: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/@dcloudio/uni-cli-shared/components/unicloud-db\" */ \"@dcloudio/uni-cli-shared/components/unicloud-db.vue\"\n      )\n    },\n    uniTable: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-table/components/uni-table/uni-table\" */ \"@/uni_modules/uni-table/components/uni-table/uni-table.vue\"\n      )\n    },\n    uniTr: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-table/components/uni-tr/uni-tr\" */ \"@/uni_modules/uni-table/components/uni-tr/uni-tr.vue\"\n      )\n    },\n    uniTh: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-table/components/uni-th/uni-th\" */ \"@/uni_modules/uni-table/components/uni-th/uni-th.vue\"\n      )\n    },\n    uniTd: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-table/components/uni-td/uni-td\" */ \"@/uni_modules/uni-table/components/uni-td/uni-td.vue\"\n      )\n    },\n    fixWindow: function () {\n      return import(\n        /* webpackChunkName: \"components/fix-window/fix-window\" */ \"@/components/fix-window/fix-window.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var m0 = _vm.$t(\"menu.text.menuManager\")\n  var g0 = _vm.pluginMenus.length\n  var m1 = g0 ? _vm.$t(\"menu.text.additiveMenu\") : null\n  var g1 = g0 ? _vm.pluginMenus.length : null\n  var m2 = _vm.$t(\"menu.button.addFirstLevelMenu\")\n  var m3 = _vm.$t(\"menu.button.updateBuiltInMenu\")\n  var m4 = _vm.$hasScopedSlotsParams(\"b98ade02-3\")\n  var m5 = m4\n    ? _vm.$getScopedSlotsParams(\"b98ade02-3\", \"default\", \"loading\")\n    : null\n  var m6 = m4 ? _vm.errMsg || _vm.$t(\"common.empty\") : null\n  var l0 = m4\n    ? _vm.__map(\n        _vm.$getScopedSlotsParams(\"b98ade02-3\", \"default\", \"data\"),\n        function (item, index) {\n          var $orig = _vm.__get_orig(item)\n          var m7 = _vm.$t(\"common.button.edit\")\n          var m8 =\n            item.menu_id !== \"system_menu\" &&\n            item.menu_id !== \"system_management\"\n              ? _vm.$t(\"common.button.delete\")\n              : null\n          var m9 = !item.url ? _vm.$t(\"menu.button.addChildMenu\") : null\n          return {\n            $orig: $orig,\n            m7: m7,\n            m8: m8,\n            m9: m9,\n          }\n        }\n      )\n    : null\n  if (!_vm._isMounted) {\n    _vm.e0 = function ($event, item) {\n      var _temp = arguments[arguments.length - 1].currentTarget.dataset,\n        _temp2 = _temp.eventParams || _temp[\"event-params\"],\n        item = _temp2.item\n      var _temp, _temp2\n      return _vm.navigateTo(\"./edit?id=\" + item._id, false)\n    }\n    _vm.e1 = function ($event, item) {\n      var _temp3 = arguments[arguments.length - 1].currentTarget.dataset,\n        _temp4 = _temp3.eventParams || _temp3[\"event-params\"],\n        item = _temp4.item\n      var _temp3, _temp4\n      return _vm.confirmDelete(item)\n    }\n    _vm.e2 = function ($event, item) {\n      var _temp5 = arguments[arguments.length - 1].currentTarget.dataset,\n        _temp6 = _temp5.eventParams || _temp5[\"event-params\"],\n        item = _temp6.item\n      var _temp5, _temp6\n      return _vm.navigateTo(\"./add?parent_id=\" + item.menu_id, false)\n    }\n  }\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        m0: m0,\n        g0: g0,\n        m1: m1,\n        g1: g1,\n        m2: m2,\n        m3: m3,\n        m4: m4,\n        m5: m5,\n        m6: m6,\n        l0: l0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./list.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./list.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<view class=\"uni-header\">\r\n\t\t\t<uni-stat-breadcrumb class=\"uni-stat-breadcrumb-on-phone\"/>\r\n\t\t</view>\r\n\t\t<view class=\"uni-tabs__header\">\r\n\t\t\t<view class=\"uni-tabs__nav-wrap\">\r\n\t\t\t\t<view class=\"uni-tabs__nav-scroll\">\r\n\t\t\t\t\t<view class=\"uni-tabs__nav\">\r\n\t\t\t\t\t\t<view @click=\"switchTab('menus')\" :class=\"{'is-active':currentTab==='menus'}\"\r\n\t\t\t\t\t\t\t  class=\"uni-tabs__item\">\r\n\t\t\t\t\t\t\t{{ $t('menu.text.menuManager') }}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view @click=\"switchTab('pluginMenus')\" v-if=\"pluginMenus.length\"\r\n\t\t\t\t\t\t  :class=\"{'is-active':currentTab==='pluginMenus'}\" class=\"uni-tabs__item\">\r\n\t\t\t\t\t\t\t{{ $t('menu.text.additiveMenu') }}\r\n\t\t\t\t\t\t\t<uni-badge class=\"menu-badge\" :text=\"pluginMenus.length\" type=\"error\"></uni-badge>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view v-show=\"currentTab==='menus'\">\r\n\t\t\t<view class=\"uni-header\" style=\"border-bottom: 0;margin-bottom: -15px;\">\r\n\t\t\t\t<view class=\"uni-group\">\r\n\t\t\t\t\t<button @click=\"navigateTo('./add')\" size=\"mini\" plain=\"true\"\r\n\t\t\t\t\t\t\ttype=\"primary\">{{ $t('menu.button.addFirstLevelMenu') }}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<button @click=\"updateBuiltInMenu\" size=\"mini\" plain=\"true\" style=\"margin-left: 10px;\"\r\n\t\t\t\t\t\t\ttype=\"warn\">{{ $t('menu.button.updateBuiltInMenu') }}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"uni-group\">\r\n\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"uni-container\">\r\n\t\t\t\t<unicloud-db ref=\"udb\" @load=\"onqueryload\" collection=\"opendb-admin-menus\" :options=\"options\"\r\n\t\t\t\t\t\t\t :where=\"where\" page-data=\"replace\" :orderby=\"orderby\" :getcount=\"true\"\r\n\t\t\t\t\t\t\t :page-size=\"options.pageSize\"\r\n\t\t\t\t\t\t\t :page-current=\"options.pageCurrent\" v-slot:default=\"{data,pagination,loading,error}\">\r\n\t\t\t\t\t<uni-table :loading=\"loading\" class=\"table-pc\" :emptyText=\"errMsg || $t('common.empty')\" border\r\n\t\t\t\t\t\t\t   stripe>\r\n\t\t\t\t\t\t<uni-tr>\r\n\t\t\t\t\t\t\t<uni-th align=\"center\">排序</uni-th>\r\n\t\t\t\t\t\t\t<uni-th width=\"200\" align=\"center\">名称</uni-th>\r\n\t\t\t\t\t\t\t<uni-th align=\"center\">标识</uni-th>\r\n\t\t\t\t\t\t\t<uni-th align=\"center\">URL</uni-th>\r\n\t\t\t\t\t\t\t<uni-th width=\"100\" align=\"center\">是否启用</uni-th>\r\n\t\t\t\t\t\t\t<uni-th align=\"center\">操作</uni-th>\r\n\t\t\t\t\t\t</uni-tr>\r\n\t\t\t\t\t\t<uni-tr v-for=\"(item,index) in data\" :key=\"index\">\r\n\t\t\t\t\t\t\t<uni-td align=\"center\">{{ item.sort }}</uni-td>\r\n\t\t\t\t\t\t\t<uni-td>{{ item.name }}</uni-td>\r\n\t\t\t\t\t\t\t<uni-td>{{ item.menu_id }}</uni-td>\r\n\t\t\t\t\t\t\t<uni-td>{{ item.url }}</uni-td>\r\n\t\t\t\t\t\t\t<uni-td align=\"center\" :class=\"{'menu-disable':!item.enable}\">\r\n\t\t\t\t\t\t\t\t{{ item.enable ? '已启用' : '未启用' }}\r\n\t\t\t\t\t\t\t</uni-td>\r\n\t\t\t\t\t\t\t<uni-td align=\"center\">\r\n\t\t\t\t\t\t\t\t<view class=\"uni-group\" style=\"justify-content: left;\">\r\n\t\t\t\t\t\t\t\t\t<button @click=\"navigateTo('./edit?id='+item._id, false)\" class=\"uni-button\"\r\n\t\t\t\t\t\t\t\t\t\t\tsize=\"mini\" type=\"primary\">{{ $t('common.button.edit') }}\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tv-if=\"item.menu_id !== 'system_menu' && item.menu_id !== 'system_management'\"\r\n\t\t\t\t\t\t\t\t\t\t@click=\"confirmDelete(item)\" class=\"uni-button\" size=\"mini\"\r\n\t\t\t\t\t\t\t\t\t\ttype=\"warn\">{{ $t('common.button.delete') }}\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t<button v-if=\"!item.url\" @click=\"navigateTo('./add?parent_id='+item.menu_id, false)\"\r\n\t\t\t\t\t\t\t\t\t\t\tclass=\"uni-button\" size=\"mini\"\r\n\t\t\t\t\t\t\t\t\t\t\ttype=\"primary\">{{ $t('menu.button.addChildMenu') }}\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</uni-td>\r\n\t\t\t\t\t\t</uni-tr>\r\n\t\t\t\t\t</uni-table>\r\n\t\t\t\t</unicloud-db>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view v-show=\"currentTab==='pluginMenus'\">\r\n\t\t\t<view class=\"uni-header\" style=\"border-bottom: 0;margin-bottom: -15px;\">\r\n\t\t\t\t<view class=\"uni-group\">\r\n\t\t\t\t\t<button style=\"width: 130px;\" @click=\"addPluginMenus\" size=\"mini\" type=\"primary\">添加选中的菜单\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"uni-group\"></view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"uni-container\">\r\n\t\t\t\t<uni-table ref=\"pluginMenusTable\" type=\"selection\" border stripe\r\n\t\t\t\t\t\t   @selection-change=\"pluginMenuSelectChange\">\r\n\t\t\t\t\t<uni-tr>\r\n\t\t\t\t\t\t<uni-th align=\"center\">名称（标识）</uni-th>\r\n\t\t\t\t\t\t<uni-th align=\"center\">URL</uni-th>\r\n\t\t\t\t\t\t<uni-th align=\"center\">插件菜单 json 文件</uni-th>\r\n\t\t\t\t\t</uni-tr>\r\n\t\t\t\t\t<uni-tr v-for=\"(item,index) in pluginMenus\" :key=\"index\">\r\n\t\t\t\t\t\t<uni-td>{{ item.name }}（{{ item.menu_id }}）</uni-td>\r\n\t\t\t\t\t\t<uni-td>{{ item.url }}</uni-td>\r\n\t\t\t\t\t\t<uni-td>{{ item.json }}</uni-td>\r\n\t\t\t\t\t</uni-tr>\r\n\t\t\t\t</uni-table>\r\n\t\t\t\t<view class=\"uni-sub-title\" style=\"margin-top: 15px;\">\r\n\t\t\t\t\t以上待添加菜单来自于三方插件，添加后，将显示在菜单管理中，若不希望显示在上述表格中时，可手动删除项目中对应的`插件id-menu.json`文件。\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- #ifndef H5 -->\r\n\t\t<fix-window/>\r\n\t\t<!-- #endif -->\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n\tbuildMenus\r\n} from '../../../components/uni-data-menu/util.js'\r\n\r\nimport originalMenuList from './originalMenuList.json'\r\n\r\nconst db = uniCloud.database()\r\n// 表查询配置\r\nconst dbOrderBy = 'create_date asc'\r\n// 分页配置\r\nconst pageSize = 20000\r\nconst pageCurrent = 1\r\n// 查找插件注册的菜单列表（目前仅在开发模式启用，仅限 admin 角色）\r\nconst pluginMenuJsons = []\r\n\r\nif (process.env.NODE_ENV === 'development') {\r\n\t// #ifdef VUE2\r\n\tconst rootModules = require.context(\r\n\t\t'../../../',\r\n\t\tfalse,\r\n\t\t/-menu.json$/\r\n\t)\r\n\trootModules.keys().forEach(function (key) {\r\n\t\tconst json = key.substr(2)\r\n\t\trootModules(key).forEach(item => {\r\n\t\t\titem.json = json\r\n\t\t\tpluginMenuJsons.push(item)\r\n\t\t})\r\n\t})\r\n\r\n\tconst pluginModules = require.context(\r\n\t\t'../../../uni_modules/',\r\n\t\ttrue,\r\n\t\t/menu.json$/\r\n\t)\r\n\tpluginModules.keys().forEach(function (key) {\r\n\t\tconst json = 'uni_modules' + key.substr(1)\r\n\t\tpluginModules(key).forEach(item => {\r\n\t\t\titem.json = json\r\n\t\t\tpluginMenuJsons.push(item)\r\n\t\t})\r\n\t})\r\n\t// #endif\r\n\t// #ifdef VUE3\r\n\tconst rootModules = import.meta.glob('../../../*-menu.json', {eager: true});\r\n\tfor (const modulePath in rootModules) {\r\n\t\tconst json = modulePath.replace(/^..\\/..\\/..\\//, '');\r\n\t\tlet moduleItem = rootModules[modulePath];\r\n\t\tif (typeof moduleItem === \"function\") {\r\n\t\t\t// 兼容 HBX3.6.5或以下版本\r\n\t\t\tmoduleItem().then(module => {\r\n\t\t\t\tmodule = module.default ? module.default : module\r\n\t\t\t\tmodule.forEach(item => {\r\n\t\t\t\t\titem.json = json\r\n\t\t\t\t\tpluginMenuJsons.push(item)\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\t// 兼容 HBX3.6.13或以上版本\r\n\t\t\tlet module = moduleItem.default ? moduleItem.default : moduleItem;\r\n\t\t\tmodule.forEach(item => {\r\n\t\t\t\titem.json = json\r\n\t\t\t\tpluginMenuJsons.push(item)\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tconst pluginModules = import.meta.glob('../../../uni_modules/**/menu.json', {eager: true});\r\n\tfor (const modulePath in pluginModules) {\r\n\t\tconst json = modulePath.replace(/^..\\/..\\/..\\//, '');\r\n\t\tlet moduleItem = pluginModules[modulePath];\r\n\t\tif (typeof moduleItem === \"function\") {\r\n\t\t\t// 兼容 HBX3.6.5或以下版本\r\n\t\t\tmoduleItem().then(module => {\r\n\t\t\t\tmodule = module.default ? module.default : module\r\n\t\t\t\tmodule.forEach(item => {\r\n\t\t\t\t\titem.json = json\r\n\t\t\t\t\tpluginMenuJsons.push(item)\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\t// 兼容 HBX3.6.13或以上版本\r\n\t\t\tlet module = moduleItem.default ? moduleItem.default : moduleItem;\r\n\t\t\tmodule.forEach(item => {\r\n\t\t\t\titem.json = json\r\n\t\t\t\tpluginMenuJsons.push(item)\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t// #endif\r\n}\r\n\r\n\r\n// 获取父的个数\r\nfunction getParents(menus, id, depth = 0) {\r\n\tmenus.forEach(menu => {\r\n\t\tif (menu.menu_id === id && menu.parent_id) {\r\n\t\t\tdepth = depth + 1 + getParents(menus, menu.parent_id, depth)\r\n\t\t}\r\n\t})\r\n\treturn depth\r\n}\r\n\r\n// 获取子的 _id\r\nfunction getChildren(menus, id, childrenIds = []) {\r\n\tif (menus.find(menu => menu.parent_id === id)) {\r\n\t\tmenus.forEach(item => {\r\n\t\t\tif (item.parent_id === id) {\r\n\t\t\t\tchildrenIds.push(item._id)\r\n\t\t\t\tgetChildren(menus, item.menu_id, childrenIds)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\treturn childrenIds\r\n}\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tquery: '',\r\n\t\t\twhere: '',\r\n\t\t\torderby: dbOrderBy,\r\n\t\t\toptions: {\r\n\t\t\t\tpageSize,\r\n\t\t\t\tpageCurrent\r\n\t\t\t},\r\n\t\t\tselectedIndexs: [], //批量选中的项\r\n\t\t\tloading: true,\r\n\t\t\tmenus: [],\r\n\t\t\terrMsg: '',\r\n\t\t\tcurrentTab: 'menus',\r\n\t\t\tselectedPluginMenuIndexs: []\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\tpluginMenus() {\r\n\t\t\tconst menus = []\r\n\t\t\tif (!this.$hasRole('admin')) {\r\n\t\t\t\treturn menus\r\n\t\t\t}\r\n\t\t\tconst dbMenus = this.menus\r\n\t\t\tif (!dbMenus.length) {\r\n\t\t\t\treturn menus\r\n\t\t\t}\r\n\t\t\tpluginMenuJsons.forEach(menu => {\r\n\t\t\t\t// 查找尚未被注册到数据库中的菜单\r\n\t\t\t\tif (!dbMenus.find(item => item.menu_id === menu.menu_id)) {\r\n\t\t\t\t\tmenus.push(menu)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn menus\r\n\t\t},\r\n\t},\r\n\twatch: {\r\n\t\tpluginMenus(val) {\r\n\t\t\tif (!val.length) {\r\n\t\t\t\tthis.currentTab = 'menus'\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tgetSortMenu(menuList) {\r\n\t\t\t// 标记叶子节点\r\n\t\t\tmenuList.map(item => {\r\n\t\t\t\tif (!menuList.some(subMenuItem => subMenuItem.parent_id === item.menu_id)) {\r\n\t\t\t\t\titem.isLeafNode = true\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn buildMenus(menuList)\r\n\t\t},\r\n\t\tonqueryload(data) {\r\n\t\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\t\tlet item = data[i]\r\n\t\t\t\tconst depth = getParents(data, item.menu_id)\r\n\t\t\t\titem.name = (depth ? '　'.repeat(depth) + '|-' : '') + item.name\r\n\t\t\t}\r\n\t\t\tconst menuTree = this.getSortMenu(data)\r\n\t\t\tconst sortMenus = []\r\n\t\t\tthis.patTree(menuTree, sortMenus)\r\n\t\t\tdata.length = 0;\r\n\t\t\tdata.push(...sortMenus)\r\n\t\t\tthis.menus = data //仅导出当前页\r\n\t\t},\r\n\t\tpatTree(tree, sortMenus) {\r\n\t\t\ttree.forEach(item => {\r\n\t\t\t\tsortMenus.push(item)\r\n\t\t\t\tif (item.children.length) {\r\n\t\t\t\t\tthis.patTree(item.children, sortMenus)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn sortMenus\r\n\t\t},\r\n\t\tswitchTab(tab) {\r\n\t\t\tthis.currentTab = tab\r\n\t\t},\r\n\t\tloadData(clear = true) {\r\n\t\t\tthis.$refs.udb.loadData({\r\n\t\t\t\tclear\r\n\t\t\t})\r\n\t\t},\r\n\t\tnavigateTo(url, clear) { // clear 表示刷新列表时是否清除当前页码，true 表示刷新并回到列表第 1 页，默认为 true\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl,\r\n\t\t\t\tevents: {\r\n\t\t\t\t\trefreshData: () => {\r\n\t\t\t\t\t\tthis.loadData(clear)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tconfirmDelete(menu) {\r\n\t\t\tlet ids = menu._id\r\n\t\t\tlet content = '是否删除该菜单？'\r\n\t\t\t// 如有子菜单\r\n\t\t\tconst children = getChildren(this.menus, menu.menu_id)\r\n\t\t\tif (children.length) content = '是否删除该菜单及其子菜单？'\r\n\t\t\tids = [ids, ...children]\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: '提示',\r\n\t\t\t\tcontent,\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tif (!res.confirm) {\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.$refs.udb.remove(ids, {\r\n\t\t\t\t\t\tneedConfirm: false\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tpluginMenuSelectChange(e) {\r\n\t\t\tthis.selectedPluginMenuIndexs = e.detail.index\r\n\t\t},\r\n\t\taddPluginMenus(confirmContent) {\r\n\t\t\tif (!this.selectedPluginMenuIndexs.length) {\r\n\t\t\t\treturn uni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '请选择要添加的菜单！',\r\n\t\t\t\t\tshowCancel: false\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tconst pluginMenus = this.pluginMenus\r\n\t\t\tconst menus = []\r\n\t\t\tthis.selectedPluginMenuIndexs.forEach(i => {\r\n\t\t\t\tconst menu = pluginMenus[i]\r\n\t\t\t\tif (menu) {\r\n\t\t\t\t\t// 拷贝一份，移除 json 字段\r\n\t\t\t\t\tconst dbMenu = JSON.parse(JSON.stringify(menu))\r\n\t\t\t\t\tdelete dbMenu.json\r\n\t\t\t\t\tmenus.push(dbMenu)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: '提示',\r\n\t\t\t\tcontent: '您确认要添加已选中的菜单吗？',\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tif (!res.confirm) {\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\tmask: true\r\n\t\t\t\t\t})\r\n\t\t\t\t\tconst checkAll = menus.length === pluginMenus.length\r\n\t\t\t\t\tuniCloud.database().collection('opendb-admin-menus').add(menus).then(res => {\r\n\t\t\t\t\t\t// this.init()\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\tcontent: '添加菜单成功！',\r\n\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\tthis.$refs.pluginMenusTable.clearSelection()\r\n\t\t\t\t\t\t\t\tif (checkAll) {\r\n\t\t\t\t\t\t\t\t\tthis.currentTab = 'menus'\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tthis.loadData()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\tcontent: err.message,\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}).finally(() => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t// 更新内置菜单\r\n\t\tasync updateBuiltInMenu(){\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: '提示',\r\n\t\t\t\tcontent: '确定更新内置菜单吗？\\n（该操作不会影响现有的菜单）',\r\n\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\tconst db = uniCloud.database();\r\n\t\t\t\t\t\tconst _ = db.command;\r\n\t\t\t\t\t\tlet menu_ids = originalMenuList.map((item, index) => {\r\n\t\t\t\t\t\t\treturn item.menu_id;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\ttitle:\"更新中...\",\r\n\t\t\t\t\t\t\tmask:true\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tlet addMenuList = [];\r\n\t\t\t\t\t\t\t// 读取菜单\r\n\t\t\t\t\t\t\tlet oldMenuListRes = await db.collection(\"opendb-admin-menus\").where({\r\n\t\t\t\t\t\t\t\tmenu_id: _.in[menu_ids]\r\n\t\t\t\t\t\t\t}).limit(500).get();\r\n\t\t\t\t\t\t\tlet oldMenuList = oldMenuListRes.result.data;\r\n\t\t\t\t\t\t\toriginalMenuList.map((item, index) => {\r\n\t\t\t\t\t\t\t\tlet oldMenuItem = oldMenuList.find((item2, index2, arr2) => {\r\n\t\t\t\t\t\t\t\t\treturn item2.menu_id === item.menu_id;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tif (!oldMenuItem) {\r\n\t\t\t\t\t\t\t\t\taddMenuList.push({\r\n\t\t\t\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\t\t\t\tcreate_date: undefined\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tif (addMenuList && addMenuList.length > 0) {\r\n\t\t\t\t\t\t\t\t// 添加没有的菜单\r\n\t\t\t\t\t\t\t\tlet addRes = await db.collection(\"opendb-admin-menus\").add(addMenuList);\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle:`新增了${addRes.result.inserted}个菜单，即将刷新`,\r\n\t\t\t\t\t\t\t\t\ticon:\"none\"\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t\t\t// #ifndef H5\r\n\t\t\t\t\t\t\t\t\tthis.loadData(true);\r\n\t\t\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t\t}, 300);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle:\"菜单无变动\",\r\n\t\t\t\t\t\t\t\t\ticon:\"none\"\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch(err) {\r\n\t\t\t\t\t\t\tconsole.error(err)\r\n\t\t\t\t\t\t} finally {\r\n\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n<style>\r\n/* #ifndef H5 */\r\npage {\r\n\tpadding-top: 85px;\r\n}\r\n\r\n/* #endif */\r\n.menu-disable {\r\n\tcolor: red;\r\n}\r\n\r\n.menu-badge {\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tright: 5px;\r\n}\r\n</style>\r\n","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./list.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./list.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1685326616758\n      var cssReload = require(\"D:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}